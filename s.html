<script>
    window.onload = function () {
      const payslipElement = document.getElementById('payslip-container');
      const images = payslipElement.querySelectorAll('img');
      let loadedImages = 0;

      const generatePDF = () => {
        html2pdf()
          .set({
            html2canvas: {
              allowTaint: true,
              useCORS: true,
              logging: true
            }
          })
          .from(payslipElement)
          .save('${text('empName')}_${formattedMonth}_Payslip.pdf');
      };

      if (images.length === 0) {
        generatePDF();
      } else {
        images.forEach(img => {
          if (img.complete) {
            loadedImages++;
          } else {
            img.onload = img.onerror = () => {
              loadedImages++;
              if (loadedImages === images.length) {
                generatePDF();
              }
            };
          }
        });

        // Edge case: all were already loaded
        if (loadedImages === images.length) {
          generatePDF();
        }
      }
    };
  </script>